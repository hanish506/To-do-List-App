<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Advanced To-Do App</title>

<style>
body {
  font-family: Arial, sans-serif;
  background: #eef2f3;
  display: flex;
  justify-content: center;
  align-items: center;
  height: 100vh;
}

.app {
  width: 420px;
  background: #fff;
  padding: 20px;
  border-radius: 10px;
  box-shadow: 0 5px 15px rgba(0,0,0,0.15);
}

h2 { text-align: center; }

input, select, button {
  padding: 8px;
  margin: 5px 0;
  width: 100%;
}

button {
  cursor: pointer;
  background: #007bff;
  color: #fff;
  border: none;
}

button:hover { background: #0056b3; }

.task {
  display: flex;
  justify-content: space-between;
  align-items: center;
  padding: 8px;
  border-bottom: 1px solid #ddd;
  cursor: grab;
}

.task.completed span {
  text-decoration: line-through;
  color: gray;
}

.tag {
  font-size: 12px;
  padding: 2px 6px;
  border-radius: 4px;
  background: #eee;
  margin-left: 5px;
}

.high { background: #ffcccc; }
.medium { background: #fff0b3; }
.low { background: #d4edda; }

.actions button {
  margin-left: 5px;
  background: #dc3545;
}

.actions button.complete { background: #28a745; }

.filters {
  display: flex;
  gap: 5px;
  margin: 10px 0;
}

.counter {
  text-align: center;
  font-size: 14px;
}
</style>
</head>

<body>
<div class="app">
<h2>Advanced To-Do App</h2>

<input type="text" id="taskText" placeholder="Enter task">

<select id="taskTag">
  <option>Work</option>
  <option>Study</option>
  <option>Personal</option>
  <option>Health</option>
  <option>Fitness</option>
  <option>Shopping</option>
  <option>Coding</option>
  <option>Reading</option>
  <option>Project</option>
  <option>Urgent</option>
</select>

<select id="taskPriority">
  <option value="low">Low Priority</option>
  <option value="medium">Medium Priority</option>
  <option value="high">High Priority</option>
</select>

<button onclick="addTask()">Add Task</button>

<div class="filters">
  <button onclick="filterTasks('all')">All</button>
  <button onclick="filterTasks('completed')">Completed</button>
  <button onclick="filterTasks('pending')">Pending</button>
  <button onclick="exportCSV()">Export CSV</button>
</div>

<ul id="taskList"></ul>

<div class="counter" id="counter"></div>
</div>

<script>
let tasks = JSON.parse(localStorage.getItem("tasks")) || [];
let dragStartIndex = null;

function saveTasks() {
  localStorage.setItem("tasks", JSON.stringify(tasks));
}

function addTask() {
  const text = taskText.value.trim();
  if (!text) return;

  tasks.push({
    text,
    tag: taskTag.value,
    priority: taskPriority.value,
    completed: false
  });

  taskText.value = "";
  saveTasks();
  renderTasks();
}

function renderTasks(filter = "all") {
  taskList.innerHTML = "";

  tasks.forEach((task, index) => {
    if (
      (filter === "completed" && !task.completed) ||
      (filter === "pending" && task.completed)
    ) return;

    const li = document.createElement("li");
    li.className = `task ${task.completed ? "completed" : ""}`;
    li.draggable = true;
    li.dataset.index = index;

    li.innerHTML = `
      <span>
        ${task.text}
        <span class="tag ${task.priority}">${task.tag}</span>
      </span>
      <div class="actions">
        <button class="complete" onclick="toggleTask(${index})">âœ”</button>
        <button onclick="deleteTask(${index})">ðŸ—‘</button>
      </div>
    `;

    taskList.appendChild(li);
  });

  updateCounter();
}

/* Drag & Drop Logic */
taskList.addEventListener("dragstart", e => {
  if (!e.target.classList.contains("task")) return;
  dragStartIndex = +e.target.dataset.index;
});

taskList.addEventListener("dragover", e => e.preventDefault());

taskList.addEventListener("drop", e => {
  const taskEl = e.target.closest(".task");
  if (!taskEl) return;

  const dragEndIndex = +taskEl.dataset.index;
  reorderTasks(dragStartIndex, dragEndIndex);
  saveTasks();
  renderTasks();
});

function reorderTasks(from, to) {
  if (from === to) return;
  const moved = tasks.splice(from, 1)[0];
  tasks.splice(to, 0, moved);
}

function toggleTask(index) {
  tasks[index].completed = !tasks[index].completed;
  saveTasks();
  renderTasks();
}

function deleteTask(index) {
  tasks.splice(index, 1);
  saveTasks();
  renderTasks();
}

function filterTasks(type) {
  renderTasks(type);
}

function updateCounter() {
  const completed = tasks.filter(t => t.completed).length;
  counter.textContent = `Total: ${tasks.length} | Completed: ${completed}`;
}

/* Export CSV */
function exportCSV() {
  let csv = "Task,Tag,Priority,Completed\n";
  tasks.forEach(task => {
    csv += `"${task.text}","${task.tag}","${task.priority}","${task.completed}"\n`;
  });

  const blob = new Blob([csv], { type: "text/csv" });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "todo_tasks.csv";
  a.click();

  URL.revokeObjectURL(url);
}

renderTasks();
</script>

</body>
</html>
